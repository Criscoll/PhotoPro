{"ast":null,"code":"var _jsxFileName = \"/home/matthew/Projects/capstone-project-comp3900-f11a-2mjec/photopro-app/src/components/CapturePhotoPage.jsx\";\nimport React from 'react';\nimport { Camera } from 'expo-camera';\nimport { StyleSheet, View, Text } from 'react-native';\nimport * as Permissions from 'expo-permissions';\nimport styles from './styles';\nimport Toolbar from './toolbar.component';\nimport Gallery from './gallery.component';\nexport default class CameraPage extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.camera = null;\n    this.state = {\n      captures: [],\n      capturing: null,\n      hasCameraPermission: null,\n      cameraType: Camera.Constants.Type.back,\n      flashMode: Camera.Constants.FlashMode.off\n    };\n\n    this.setFlashMode = flashMode => this.setState({\n      flashMode\n    });\n\n    this.setCameraType = cameraType => this.setState({\n      cameraType\n    });\n\n    this.handleCaptureIn = () => this.setState({\n      capturing: true\n    });\n\n    this.handleShortCapture = async () => {\n      const photoData = await this.camera.takePictureAsync();\n      this.setState({\n        capturing: false,\n        captures: [photoData, ...this.state.captures]\n      }); // var xhr = new XMLHttpRequest();\n      // xhr.open('GET', 'http://localhost:5000/');\n\n      var imageBase64 = photoData.base64.replace(/^data:image\\/(png|jpg);base64,/, ''); // console.log(imageBase64);\n      // // xhr.setRequestHeader('imageData', imageBase64);\n      // xhr.send(imageBase64);\n\n      fetch('http://' + window.location.hostname + ':5000/', {\n        method: 'POST',\n        body: imageBase64\n      }).then(async response => {\n        return response.text().then(async text => {\n          // console.log(text);\n          var wavData = atob(text);\n          const audioContext = new AudioContext();\n          const arr = Uint8Array.from(wavData, c => c.charCodeAt(0));\n          const audio = await audioContext.decodeAudioData(arr.buffer);\n          const source = audioContext.createBufferSource();\n          source.buffer = audio;\n          source.connect(audioContext.destination);\n          source.start(0);\n        });\n      });\n    };\n  }\n\n  // handleLongCapture = async () => {\n  //     const videoData = await this.camera.recordAsync();\n  //     this.setState({ capturing: false, captures: [videoData, ...this.state.captures] });\n  // };\n  async componentDidMount() {\n    const camera = await Permissions.askAsync(Permissions.CAMERA);\n    const audio = await Permissions.askAsync(Permissions.AUDIO_RECORDING);\n    let hasCameraPermission = camera.status === 'granted' && audio.status === 'granted';\n    this.setState({\n      hasCameraPermission\n    });\n  }\n\n  render() {\n    const {\n      hasCameraPermission,\n      flashMode,\n      cameraType,\n      capturing,\n      captures\n    } = this.state;\n\n    if (hasCameraPermission === null) {\n      return /*#__PURE__*/React.createElement(View, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 20\n        }\n      });\n    } else if (hasCameraPermission === false) {\n      return /*#__PURE__*/React.createElement(Text, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 20\n        }\n      }, \"Access to camera has been denied.\");\n    }\n\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(View, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Camera, {\n      type: cameraType,\n      flashMode: flashMode,\n      style: styles.preview,\n      ref: camera => this.camera = camera,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 21\n      }\n    })), captures.length > 0 && /*#__PURE__*/React.createElement(Gallery, {\n      captures: captures,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 41\n      }\n    }), /*#__PURE__*/React.createElement(Toolbar, {\n      capturing: capturing,\n      flashMode: flashMode,\n      cameraType: cameraType,\n      setFlashMode: this.setFlashMode,\n      setCameraType: this.setCameraType // onCaptureIn={this.handleCaptureIn}\n      // onCaptureOut={this.handleShortCapture}\n      // onLongCapture={this.handleLongCapture}\n      ,\n      onShortCapture: this.handleShortCapture,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n;","map":{"version":3,"sources":["/home/matthew/Projects/capstone-project-comp3900-f11a-2mjec/photopro-app/src/components/CapturePhotoPage.jsx"],"names":["React","Camera","StyleSheet","View","Text","Permissions","styles","Toolbar","Gallery","CameraPage","Component","camera","state","captures","capturing","hasCameraPermission","cameraType","Constants","Type","back","flashMode","FlashMode","off","setFlashMode","setState","setCameraType","handleCaptureIn","handleShortCapture","photoData","takePictureAsync","imageBase64","base64","replace","fetch","window","location","hostname","method","body","then","response","text","wavData","atob","audioContext","AudioContext","arr","Uint8Array","from","c","charCodeAt","audio","decodeAudioData","buffer","source","createBufferSource","connect","destination","start","componentDidMount","askAsync","CAMERA","AUDIO_RECORDING","status","render","preview","length"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Camera } from 'expo-camera';\nimport { StyleSheet, View, Text } from 'react-native';\nimport * as Permissions from 'expo-permissions';\n\nimport styles from './styles';\nimport Toolbar from './toolbar.component';\nimport Gallery from './gallery.component';\n\nexport default class CameraPage extends React.Component {\n    camera = null;\n\n    state = {\n        captures: [],\n        capturing: null,\n        hasCameraPermission: null,\n        cameraType: Camera.Constants.Type.back,\n        flashMode: Camera.Constants.FlashMode.off,\n    };\n\n    setFlashMode = (flashMode) => this.setState({ flashMode });\n    setCameraType = (cameraType) => this.setState({ cameraType });\n    handleCaptureIn = () => this.setState({ capturing: true });\n\n    // handleCaptureOut = () => {\n    //     if (this.state.capturing)\n    //         this.camera.stopRecording();\n    // };\n\n    handleShortCapture = async () => {\n        const photoData = await this.camera.takePictureAsync();\n        this.setState({ capturing: false, captures: [photoData, ...this.state.captures] });\n        // var xhr = new XMLHttpRequest();\n        // xhr.open('GET', 'http://localhost:5000/');\n        var imageBase64 = photoData.base64.replace(/^data:image\\/(png|jpg);base64,/, '');\n        // console.log(imageBase64);\n        // // xhr.setRequestHeader('imageData', imageBase64);\n        // xhr.send(imageBase64);\n        fetch('http://' + window.location.hostname + ':5000/', {method: 'POST', body: imageBase64})\n\t\t  .then(async response => {\n\t\t    return response.text().then(async text => {\n\t\t\t\t// console.log(text);\n\t\t\t\tvar wavData = atob(text);\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst arr = Uint8Array.from(wavData, c => c.charCodeAt(0))\n\t\t\t\tconst audio = await audioContext.decodeAudioData(arr.buffer);\n\t\t\t\tconst source = audioContext.createBufferSource();\n\t\t\t\tsource.buffer = audio;\n\t\t\t\tsource.connect(audioContext.destination);\n\t\t\t\tsource.start(0);\n\t\t    })\n\t\t  })\n    };\n\n    // handleLongCapture = async () => {\n    //     const videoData = await this.camera.recordAsync();\n    //     this.setState({ capturing: false, captures: [videoData, ...this.state.captures] });\n    // };\n\n    async componentDidMount() {\n        const camera = await Permissions.askAsync(Permissions.CAMERA);\n        const audio = await Permissions.askAsync(Permissions.AUDIO_RECORDING);\n        let hasCameraPermission = (camera.status === 'granted' && audio.status === 'granted');\n\n        this.setState({ hasCameraPermission });\n    };\n\n    render() {\n        const { hasCameraPermission, flashMode, cameraType, capturing, captures } = this.state;\n\n        if (hasCameraPermission === null) {\n            return <View />;\n        } else if (hasCameraPermission === false) {\n            return <Text>Access to camera has been denied.</Text>;\n\t\t}\n\n        return (\n            <React.Fragment>\n                <View>\n                    <Camera\n                        type={cameraType}\n                        flashMode={flashMode}\n                        style={styles.preview}\n                        ref={camera => this.camera = camera}\n                    />\n                </View>\n\n                {captures.length > 0 && <Gallery captures={captures}/>}\n\n                <Toolbar\n                    capturing={capturing}\n                    flashMode={flashMode}\n                    cameraType={cameraType}\n                    setFlashMode={this.setFlashMode}\n                    setCameraType={this.setCameraType}\n                    // onCaptureIn={this.handleCaptureIn}\n                    // onCaptureOut={this.handleShortCapture}\n                    // onLongCapture={this.handleLongCapture}\n                    onShortCapture={this.handleShortCapture}\n                />\n            </React.Fragment>\n        );\n    };\n};\n"]},"metadata":{},"sourceType":"module"}